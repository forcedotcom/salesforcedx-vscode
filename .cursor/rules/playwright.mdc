---
globs: *.spec.ts,**/test/web/**,**/test/playwright/**,**/playwright-vscode-ext/**
alwaysApply: false
---

## Reuse

before creating new utilities or PageObjects, look in the playwright ext for reuse opportunities

## Waiting and Timing

Never use `waitForTimeout`. Always wait for something specific on the page:

- Use `page.waitForSelector()` to wait for elements to appear
- Use `expect(locator).toBeVisible()` to wait for visibility
- Use `page.waitForLoadState()` for page state changes

Do not use `page.waitForResponse()` for network requests because it doesn't work in desktop/electron.
Do not use `networkidle` not available on desktop/electron

use `test.step` to organize sequential tests.

## File System and VS Code API

**NEVER use Node.js fs/path or VS Code API** - only work in desktop, not web.

**Use UI interactions instead:**

- `Control+p` - Quick Open
- `Control+Home`, `Control+s` - navigate and save
- `page.keyboard.type()` - edit content
- Monaco editor selectors - interact with editor

Tests must work identically in web and desktop.

## Virtualized DOM

Many things in the vscode API (tree views, editors, output panels) only contain the visible lines in the DOM (the remainder are not present until they scroll into view).

You can't rely on scrollTo because the target element doesn't exist.

## Selectors and Assertions

Prefer `aria` (getByRole) over css selectors

`expect` assertions need clear error messages. Import `expect` from playwright

Locators that might be reused by other tests in other packages belong in `locators.ts`. Check this file before creating new locator selectors.

## Commands and Shortcuts

Use f1 for commands, not meta-shift-P. Use `Control` for all. No ControlOrMeta

## Things to ignore

All installed extensions are temporarily disabled (this refers to other extensions, not the ones installed as part of our e2e)

## Debugging

LLMs should not run `debug` mode playwright tests unless instructed to. Those pause and requier the human to step through.

Use @https://playwright.dev/docs/api/class-locator#locator-inner-html on a known-good locator and use the result to get more accurate locators for stuff inside it.

Take screenshots and review them (tool call `read_file`) for additional context.

Capture html "parent" levels up from where you are having a problem and study it to make sure you are using correct locators.

Fail early, avoid creating fallbacks.

Use emojis infrequently.

Read the playwright docs
