---
globs: *.spec.ts,**/test/web/**,**/test/playwright/**,**/playwright-vscode-ext/**
alwaysApply: false
---

## Reuse

before creating new utilities or PageObjects, look in the playwright ext for reuse opportunities

## Waiting and Timing

Never use `waitForTimeout`. Always wait for something specific on the page:

- Use `page.waitForSelector()` to wait for elements to appear
- Use `expect(locator).toBeVisible()` to wait for visibility
- Use `page.waitForLoadState()` for page state changes

Do not use `page.waitForResponse()` for network requests because it doesn't work in desktop/electron.
Do not use `networkidle` not available on desktop/electron

use `test.step` to organize sequential tests.

## File System and VS Code API

**NEVER use Node.js fs/path or VS Code API** - only work in desktop, not web.

**Use UI interactions instead:**

- `Control+p` - Quick Open
- `Control+Home`, `Control+s` - navigate and save
- `page.keyboard.type()` - edit content
- Monaco editor selectors - interact with editor

Tests must work identically in web and desktop.

## Virtualized DOM

the vscode API (tree views, editors, output panels) often only contain the visible lines in the DOM (the rest are not present until they scroll into view).

Don't rely on scrollTo because the target element won't exist.
`scrollIntoViewIfNeeded` probably won't help

## ContextMenus and Mac

There is no way to read or interact with context menus (right click) on mac+Desktop+electron. Those tests/steps will need to skip themselves. Windows and Web are fine

## Selectors and Assertions

Prefer `aria` (getByRole) over css selectors

give `expect` assertions clear error messages. Import `expect` from playwright. Fail early, avoid fallbacks/retries

Locators that might be reused by other tests in other packages belong in `locators.ts`. Check this file before creating new locator selectors.

## Commands and Shortcuts

Use f1 for commands, not meta-shift-P. Use `Control` for all. No ControlOrMeta

## Things to ignore

TS extension activation: `Error: Activating extension 'vscode.typescript-language-features'`
All installed extensions are temporarily disabled (this refers to other extensions, not the ones installed as part of our e2e)
